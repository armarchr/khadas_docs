title: Platform Signature Key
---

When a third-party application requests for system permissions, it needs a `platform signature key` to install normally.

## Obtain signature key from Khadas Source
From the Khadas source code compilation environment, you can sign-in two ways.

1. Recompile your unsigned-apk with the platform signature key by adding `LOCAL_CERTIFICATE := platform` to `Android.mk`.

2. Use the signing-command:
```sh
java -Djava.library.path=out/host/linux-x86/lib64 -jar out/host/linux-x86/framework/signapk.jar build/target/product/security/platform.x509.pem build/target/product/security/platform.pk8 app-debug.apk app-debug-signed.apk
```

`app-debug.apk` is an apk that declares system permissions before signing; it declares `android:sharedUserid="android.uid.system"` in `AndroidManifeset.xml`. If the `platform signature key` of the device is not added, `adb install` will return the error `Failure INSTALL_FAILED_SHARED_USER_INCOMPATIBLE: The package couldn't be installed`. `app-debug-signed.apk` is a signed apk which can be installed directly using `adb install`.

## Sign your app using Android Studio (Windows)
Prepare the `keytool-importkeypair` script, which can be downloaded from `https://github.com/getfatday/keytool-importkeypair`. 

`platform.x509.pem` and `platform.pk8` are located in the source directory `build/target/product/security`. 

`custom.jks` is generated by Android Studio, please refer to *Android Studio JKS file generation* for details:

### Android Studio JKS file generation
![Image of jks_step](/android/images/vim3/step1.png)
![Image of jks_step](/android/images/vim3/step2.png)
![Image of jks_step](/android/images/vim3/step3.png)
![Image of jks_step](/android/images/vim3/step4.png)
![Image of jks_step](/android/images/vim3/step5.png)
![Image of jks_step](/android/images/vim3/step6.png)
![Image of jks_step](/android/images/vim3/step7.png)

After `custom.jks` is generated, use the `keytool-importkeypair` script to generate a new `custom.jks` which includes the `platform signature`. The command is as follows:

```sh
./keytool-importkeypair -k custom.jks -p 123456 -pk8 platform.pk8 -cert platform.x509.pem -alias khadasdemo
```

`custom.jks` is generated in Android Studio. `123456` is the password entered when creating `custom.jks`, and `khadasdemo` is the alias of the `.jks` file.

The new `custom.jks` generated after executing the above script will include the `platform signature key` and needs to be copied to the project directory of Android Studio. Continue on to *Android Studio configuration custom.jks* for next steps.

###  Configure custom.jks using Android Studio
Add the `signingConfigs` configuration to `build.gradle` under the project directory, and input the path, password, and alias into the .jks file as follows: 

```sh
signingConfigs { 
release { 
storeFile file("signApk/custom.jks") 
storePassword '123456'
keyAlias 'khadasdemo'
keyPassword '123456'
} 
debug { 
storeFile file("signApk/custom.jks") 
storePassword '123456'
keyAlias 'khadasdemo'
keyPassword '123456'
} 
```

After modifying the `custom.jks` file, and recompiling your app from within Android Studio, the app can be installed normally on the machine because it includes the `platform signature key`.

## Sign your app using Jarsigner (Windows)
To use Jarsigner, install jdk into Windows:

```sh
jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore custom.jks app-debug.apk khadasdemo
 signing: res/drawable-hdpi-v4/abc_textfield_activated_mtrl_alpha.9.png
 signing: res/drawable-hdpi-v4/notification_bg_low_pressed.9.png
 signing: res/layout/abc_action_menu_layout.xml
 signing: res/drawable/abc_seekbar_tick_mark_material.xml
 signing: classes.dex
 signing: res/drawable/btn_checkbox_unchecked_mtrl.xml
 signing: res/drawable-hdpi-v4/notification_bg_normal.9.png
 signing: res/layout/abc_list_menu_item_icon.xml
 signer
   X.509, EMAILADDRESS=android@android.com, CN=Android, OU=Android, O=Android, L=Mountain View, ST=California, C=US
```
`custom.jks` : ./keytool-importkeypair -k custom.jks -p 123456 -pk8 platform.pk8 -cert platform.x509.pem -alias khadasdemo ,this command to generate.
`khadasdemo` : alias.
`password` : 123456.
`app-debug.apk` : unsigned apk, signed apk name is also `app-debug.apk`.

